# Operational Runbook: Autonomous System Monitoring

**Block 10.3 ‚Äî "The System That Watches Itself"**

**Version:** 1.0.0  
**Last Updated:** November 2025  
**Status:** Operational

---

## Table of Contents

1. [Overview](#overview)
2. [Quick Reference](#quick-reference)
3. [Interpreting Monitoring Reports](#interpreting-monitoring-reports)
4. [Response Procedures](#response-procedures)
5. [Manual Monitoring Execution](#manual-monitoring-execution)
6. [Troubleshooting](#troubleshooting)
7. [Contact Escalation Matrix](#contact-escalation-matrix)
8. [Historical Incident Log](#historical-incident-log)

---

## Overview

### Purpose

This runbook provides operational guidance for responding to autonomous monitoring alerts, interpreting system health reports, and troubleshooting common issues.

### Scope

- **In Scope:** System monitoring, endpoint health, integrity verification, EWA analysis
- **Out of Scope:** Infrastructure provisioning, deployment, code changes (see separate docs)

### Key Principles

1. **Human-in-the-loop:** All critical decisions require human approval
2. **Transparency-first:** All actions logged and publicly reported
3. **Conservative response:** Investigate before intervening

---

## Quick Reference

### System States

| State | Definition | Response Time | Action Required |
|-------|------------|---------------|-----------------|
| **Healthy** | All systems operational | N/A | Continue monitoring |
| **Warning** | Non-critical issues detected | 24-48 hours | Investigate and plan resolution |
| **Degraded** | Critical systems impaired | Immediate | Investigate and resolve |

### Alert Channels

- **GitHub Issues:** Auto-created on degraded state (labeled `critical`, `monitoring`, `block-10.3`)
- **GitHub Actions:** Workflow fails with ‚ùå indicator
- **Ethics Portal:** Visual indicator at `/ethics/portal`
- **API:** Real-time status at `/api/status`

### Key Files

```
reports/monitoring/monitoring-YYYY-MM-DD.json  # Daily monitoring reports
.github/workflows/autonomous-monitoring.yml     # Automation config
scripts/monitor-system.mjs                      # Monitoring script
docs/monitoring/OPERATIONAL_RUNBOOK.md          # This document
```

---

## Interpreting Monitoring Reports

### Report Structure

```json
{
  "report_id": "monitoring-2025-11-04",
  "timestamp": "2025-11-04T00:00:00Z",
  "system_state": "healthy|warning|degraded",
  "endpoints": [...],
  "endpoint_summary": {
    "total": 7,
    "passed": 6,
    "warnings": 1,
    "failed": 0
  },
  "tls": { "valid": true, "days_remaining": 92 },
  "integrity": { "status": "healthy", "issues": 0 },
  "ewa": { "total_insights": 3, "critical_insights": 0 },
  "recommendations": [...]
}
```

### Key Metrics

#### 1. System State

**Healthy:**
- All critical endpoints available
- Response times acceptable
- TLS certificate valid
- No integrity issues

**Warning:**
- Non-critical endpoint slow or failed
- Response times elevated
- TLS expiring soon (7-30 days)
- Minor integrity issues

**Degraded:**
- Critical endpoint unavailable
- TLS invalid or expired
- Integrity state attention_required
- Multiple endpoint failures

#### 2. Endpoint Health

Each endpoint reports:

```json
{
  "endpoint": "Status API",
  "url": "/api/status",
  "available": true,
  "status_code": 200,
  "response_time_ms": 850,
  "status": "pass",
  "notes": "OK"
}
```

**Status Values:**
- `pass` ‚Äî Endpoint healthy
- `warning` ‚Äî Slow but available
- `fail` ‚Äî Unavailable or error

#### 3. TLS Certificate

```json
{
  "valid": true,
  "issuer": "Let's Encrypt",
  "valid_to": "2026-02-04",
  "days_remaining": 92,
  "error": null
}
```

**Action Thresholds:**
- `days_remaining > 30` ‚Äî No action
- `days_remaining 7-30` ‚Äî Schedule renewal
- `days_remaining < 7` ‚Äî Immediate renewal

#### 4. Recommendations

Prioritized action items generated by the system:

```json
{
  "priority": "critical|high|medium|low",
  "action": "Brief description",
  "details": "Detailed explanation"
}
```

**Priority Levels:**
- **Critical:** Requires immediate action (< 1 hour)
- **High:** Requires action within 24 hours
- **Medium:** Plan resolution within 1 week
- **Low:** Non-urgent, address as capacity allows

---

## Response Procedures

### Procedure 1: Degraded State Response

**Trigger:** `system_state === "degraded"`

**Steps:**

1. **Acknowledge Alert (< 15 minutes)**
   - Check GitHub issue (auto-created)
   - Review monitoring report
   - Assign to appropriate team member

2. **Assess Severity (< 30 minutes)**
   - Identify affected endpoints
   - Determine user impact
   - Check if incident is ongoing

3. **Investigate Root Cause (< 1 hour)**
   - Review recent deployments
   - Check infrastructure status
   - Examine logs and error messages

4. **Implement Fix (< 2 hours for critical)**
   - Apply remediation
   - Test in staging if possible
   - Deploy to production

5. **Verify Resolution (< 30 minutes post-fix)**
   - Run manual monitoring check:
     ```bash
     node scripts/monitor-system.mjs --verbose
     ```
   - Confirm endpoints healthy
   - Update GitHub issue

6. **Post-Mortem (< 48 hours)**
   - Document incident in governance ledger
   - Identify preventive measures
   - Update monitoring thresholds if needed

**Example Response:**

```bash
# Step 1: Check current state
curl https://quantumpoly.ai/api/status

# Step 2: Review full report
cat reports/monitoring/monitoring-$(date -u +%Y-%m-%d).json | jq .

# Step 3: Run manual check
node scripts/monitor-system.mjs --verbose

# Step 4: After fix, verify
node scripts/monitor-system.mjs --dry-run
```

---

### Procedure 2: Warning State Response

**Trigger:** `system_state === "warning"`

**Steps:**

1. **Review Report (< 24 hours)**
   - Access via `/ethics/portal` or reports directory
   - Identify warnings
   - Assess trend (improving/declining)

2. **Investigate Non-Critical Issues (< 48 hours)**
   - Check slow endpoints
   - Review expiring TLS certificates
   - Examine minor integrity issues

3. **Plan Resolution (< 1 week)**
   - Create GitHub issue (if not auto-created)
   - Schedule fix
   - Document in project board

4. **Implement Fix**
   - Apply during normal maintenance window
   - No urgency required unless degrading

5. **Verify Resolution**
   - Wait for next automated monitoring run
   - Confirm warning cleared

---

### Procedure 3: TLS Certificate Renewal

**Trigger:** `tls.days_remaining < 30`

**Steps:**

1. **Check Certificate Status**
   ```bash
   node scripts/verify-domain.mjs
   ```

2. **Renew Certificate (Vercel/Let's Encrypt)**
   - Vercel: Auto-renews (verify in dashboard)
   - Manual: Follow certificate provider instructions

3. **Verify Renewal**
   ```bash
   # Check new expiration
   echo | openssl s_client -servername quantumpoly.ai -connect quantumpoly.ai:443 2>/dev/null | openssl x509 -noout -dates
   ```

4. **Update Monitoring**
   - Next monitoring run will reflect new dates
   - Verify `days_remaining` increased

---

### Procedure 4: Endpoint Performance Degradation

**Trigger:** Response time > 5000ms

**Steps:**

1. **Identify Slow Endpoint**
   - Check `endpoints[]` in monitoring report
   - Note response time

2. **Diagnose Cause**
   - Check server load
   - Review recent code changes
   - Examine database query performance
   - Check external API dependencies

3. **Apply Optimization**
   - Optimize database queries
   - Add caching
   - Increase server resources
   - Implement CDN

4. **Verify Improvement**
   ```bash
   # Manual timing test
   time curl -I https://quantumpoly.ai/api/ethics/summary
   ```

5. **Monitor Trend**
   - Wait for next automated run
   - Confirm response times reduced

---

## Manual Monitoring Execution

### Local Execution

**Basic Run:**
```bash
node scripts/monitor-system.mjs
```

**Dry Run (No Report Saved):**
```bash
node scripts/monitor-system.mjs --dry-run
```

**Verbose Output:**
```bash
node scripts/monitor-system.mjs --verbose
```

**Custom Base URL:**
```bash
node scripts/monitor-system.mjs --base-url=https://staging.quantumpoly.ai
```

**Skip Expensive Checks:**
```bash
node scripts/monitor-system.mjs --no-integrity --no-ewa
```

**Custom Report Path:**
```bash
node scripts/monitor-system.mjs --report=reports/manual-check.json
```

### GitHub Actions Manual Trigger

1. Navigate to **Actions** tab
2. Select **"Autonomous System Monitoring"**
3. Click **"Run workflow"**
4. Configure options:
   - `base_url` ‚Äî Target URL
   - `skip_integrity` ‚Äî Skip ledger checks
   - `skip_ewa` ‚Äî Skip ethical analysis
5. Click **"Run workflow"**

### Interpreting Output

**Successful Run (Exit Code 0):**
```
üîç Autonomous System Monitoring
   Target: https://quantumpoly.ai
   ...
‚úÖ All systems operational - exiting with code 0
```

**Degraded Run (Exit Code 1):**
```
üîç Autonomous System Monitoring
   Target: https://quantumpoly.ai
   ...
‚ùå System degraded - exiting with code 1
```

---

## Troubleshooting

### Issue 1: Monitoring Script Fails to Run

**Symptoms:**
- GitHub Actions workflow fails
- Error: `Cannot find module`

**Causes:**
- Missing dependencies
- Incorrect Node.js version

**Resolution:**
```bash
# Check Node.js version (requires 20.x)
node --version

# Reinstall dependencies
npm ci

# Test locally
node scripts/monitor-system.mjs --dry-run
```

---

### Issue 2: False Positive "Degraded" State

**Symptoms:**
- System reported as degraded
- Manual checks show all services operational

**Causes:**
- Temporary network issue
- Monitoring script bug
- Threshold too strict

**Resolution:**
1. Run manual check:
   ```bash
   node scripts/monitor-system.mjs --verbose
   ```
2. Check actual endpoint availability:
   ```bash
   curl -I https://quantumpoly.ai/api/status
   ```
3. If false positive, adjust thresholds in `scripts/monitor-system.mjs`
4. Document in GitHub issue

---

### Issue 3: Reports Not Generated

**Symptoms:**
- No report file created
- Workflow succeeds but artifact missing

**Causes:**
- File write permission issue
- Directory does not exist
- Dry-run mode enabled

**Resolution:**
```bash
# Create reports directory
mkdir -p reports/monitoring

# Check permissions
ls -ld reports/monitoring

# Ensure not in dry-run mode
node scripts/monitor-system.mjs  # Remove --dry-run flag
```

---

### Issue 4: TLS Check Fails on Localhost

**Symptoms:**
- `tls.valid === false`
- Error: "Not HTTPS"

**Causes:**
- Testing against `localhost` (HTTP only)

**Resolution:**
```bash
# Use HTTPS base URL
node scripts/monitor-system.mjs --base-url=https://quantumpoly.ai
```

**Note:** TLS checks always fail for HTTP URLs (expected behavior).

---

### Issue 5: EWA Analysis Timeout

**Symptoms:**
- Monitoring script hangs
- EWA section shows error

**Causes:**
- Large governance ledger
- EWA script timeout

**Resolution:**
```bash
# Skip EWA temporarily
node scripts/monitor-system.mjs --no-ewa

# Or increase timeout in monitor-system.mjs
# execSync options: { timeout: 60000 }  // 60 seconds
```

---

## Contact Escalation Matrix

### Level 1: Operational Issues (Response: < 2 hours)

**Scope:** Service degradation, endpoint failures, performance issues

**Contact:**
- **Technical Lead:** See `CONTRIBUTING.md`
- **DevOps Team:** (Configure in team settings)

**Action:**
- Investigate and resolve
- Update GitHub issue
- Document in monitoring ledger

---

### Level 2: Integrity & Ethical Issues (Response: < 24 hours)

**Scope:** Ledger integrity failures, EWA critical insights, governance violations

**Contact:**
- **Governance Officer:** `governance@quantumpoly.ai`
- **Ethics Committee:** See `governance/audits/README.md`

**Action:**
- Review integrity reports
- Assess ethical implications
- Determine if public disclosure required

---

### Level 3: Security & Compliance (Response: Immediate)

**Scope:** TLS failures, security vulnerabilities, data breaches

**Contact:**
- **Security Team:** `security@quantumpoly.ai`
- **Legal/Compliance:** `legal@quantumpoly.ai`

**Action:**
- Immediate investigation
- Incident response protocol
- Regulatory notification if required

---

### Level 4: Public Communication (Response: < 4 hours for critical)

**Scope:** Service outages affecting users, public-facing incidents

**Contact:**
- **Communications Lead:** See `CONTRIBUTING.md`
- **Governance Officer:** `governance@quantumpoly.ai`

**Action:**
- Draft public statement
- Update status page
- Coordinate with ethics portal

---

## Historical Incident Log

### Template

```markdown
## Incident: [Brief Description]

**Date:** YYYY-MM-DD  
**Duration:** [Hours/Minutes]  
**Severity:** Critical / High / Medium / Low  
**System State:** Degraded / Warning  

### Summary

[What happened]

### Root Cause

[Why it happened]

### Resolution

[How it was fixed]

### Preventive Measures

[Actions to prevent recurrence]

### Ledger Reference

[Link to governance ledger entry]
```

---

### Example Entry

## Incident: Status API Unavailable

**Date:** 2025-11-03  
**Duration:** 45 minutes  
**Severity:** High  
**System State:** Degraded  

### Summary

The `/api/status` endpoint returned 503 errors from 14:30 to 15:15 UTC, causing the monitoring system to report a degraded state.

### Root Cause

Vercel serverless function cold start timeout due to increased dependency size after recent update.

### Resolution

1. Optimized imports to reduce bundle size
2. Increased function timeout from 10s to 30s
3. Added warming requests to keep function hot

### Preventive Measures

- Monitor bundle size in CI/CD
- Implement periodic health check to prevent cold starts
- Add alerting for function timeout errors

### Ledger Reference

`governance/ledger/ledger.jsonl` entry `monitoring-incident-2025-11-03`

---

## Appendix

### Useful Commands

**Check System Status:**
```bash
curl https://quantumpoly.ai/api/status | jq .
```

**View Latest Monitoring Report:**
```bash
cat reports/monitoring/monitoring-$(date -u +%Y-%m-%d).json | jq .
```

**Run Manual Monitoring:**
```bash
node scripts/monitor-system.mjs --verbose
```

**Check TLS Certificate:**
```bash
echo | openssl s_client -servername quantumpoly.ai -connect quantumpoly.ai:443 2>/dev/null | openssl x509 -noout -dates
```

**Verify Integrity:**
```bash
node scripts/verify-integrity.mjs --dry-run --verbose
```

**Run EWA Analysis:**
```bash
node scripts/ewa-analyze.mjs --dry-run
```

---

### Monitoring Checklist

**Daily (Automated):**
- [ ] Monitoring script executed
- [ ] Report generated and committed
- [ ] No critical issues detected

**Weekly (Manual Review):**
- [ ] Review 7-day trend
- [ ] Check for recurring warnings
- [ ] Verify uptime percentage > 99%

**Monthly (Governance Review):**
- [ ] Analyze incident patterns
- [ ] Update thresholds if needed
- [ ] Review and update runbook
- [ ] Report to governance committee

---

## Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0.0 | 2025-11-04 | A.I.K | Initial release |

---

**For technical questions:** See `BLOCK10.3_IMPLEMENTATION_SUMMARY.md`  
**For philosophical questions:** See `BLOCK10.3_ETHICAL_REFLECTION.md`  
**For general support:** `governance@quantumpoly.ai`

---

*"The system watches itself‚Äîbut humans remain responsible."*

